import java.util.*;public class Main {    static final class FM {        final int n;        final int[] bit;        final int INF;        FM(int n, int INF) {            this.n = n;            this.INF = INF;            this.bit = new int[n + 2];            Arrays.fill(this.bit, INF);        }        void update(int idx, int val) {            for (int i = idx; i <= n; i += i & -i) {                if (val < bit[i]) {                    bit[i] = val;                }            }        }        int query(int idx) {            int res = INF;            for (int i = idx; i > 0; i -= i & -i) {                if (bit[i] < res) {                    res = bit[i];                }            }            return res;        }    }    public static int lowerBound(long[] arr, int n, long x) {        int l = 0, r = n;        while (l < r) {            int m = (l + r) >>> 1;            if (arr[m] < x) {                l = m + 1;            }            else {                r = m;            }        }        return l;    }    public static void main(String[] args) {        Scanner sc = new Scanner(System.in);        int t = sc.nextInt();        while (t -- > 0) {            int n = sc.nextInt();            long[] a = new long[n + 2];            long[] vals = new long[n];            for (int i = 1; i <= n; i++) {                a[i] = sc.nextLong();                vals[i - 1] = a[i];            }            Arrays.sort(vals);            int m = 0;            for (int i = 0; i < n; i++) {                if (i == 0 || vals[i] != vals[i - 1]) {                    vals[m++] = vals[i];                }            }            int[] pos = new int[n + 2];            for (int i = 1; i <= n; i++) {                int p = lowerBound(vals, m, a[i]) + 1;                pos[i] = p;            }            int[] nextBreak = new int[n + 2];            int nb = n + 1;            nextBreak[n] = n + 1;            for (int i = n - 1; i >= 1; i--) {                if (a[i + 1] > a[i] + 1) {                    nb = i + 1;                }                nextBreak[i] = nb;            }            int INF = n + 1;            FM bit = new FM(m, INF);            int[] nextLeq = new int[n + 2];            for (int i = n; i >= 1; i--) {                int p = pos[i];                int j = bit.query(p);                nextLeq[i] = (j == INF) ? (n + 1) : j;                bit.update(p, i);            }            int[] nxt = new int[n + 2];            nxt[n + 1] = n + 1;            for (int i = 1; i <= n; i++) {                int j = nextBreak[i];                int k = nextLeq[i];                nxt[i] = j < k ? j : k;            }            long[] F = new long[n + 2];            F[n + 1] = 0;            long ans = 0;            for (int i = n; i >= 1; i--) {                F[i] = (long)(n - i + 1) + F[nxt[i]];                ans += F[i];            }            System.out.println(ans);        }    }}