<h3><a href="https://codeforces.com/contest/2202/problem/G2" target="_blank" rel="noopener noreferrer">Monotone Monochrome Matrices (Hard Version)</a></h3>

<div class="header"><div class="title">G2. Monotone Monochrome Matrices (Hard Version)</div><div class="time-limit"><div class="property-title">time limit per test</div>4 seconds</div><div class="memory-limit"><div class="property-title">memory limit per test</div>512 megabytes</div><div class="input-file input-standard"><div class="property-title">input</div>standard input</div><div class="output-file output-standard"><div class="property-title">output</div>standard output</div></div><div><p> </p><p><span class="tex-font-style-bf">This is the hard version of the problem. The difference between the versions is that in this version, the constraints on $$$n$$$ and $$$q$$$ are very large. You can hack only if you solved all versions of this problem.</span> </p><p>A <span class="tex-font-style-bf">monochrome matrix</span> of size $$$n \times n$$$ is a matrix of $$$n$$$ rows and $$$n$$$ columns, where each cell is colored either black or white. Let the color of cell $$$(r,c)$$$ in a monochrome matrix $$$C$$$ be denoted as $$$C[r,c]$$$.</p><p>Let's call such a matrix $$$C$$$ <span class="tex-font-style-bf">monotone</span> if it satisfies the following condition:</p><ul> <li> There exist no two rows $$$1 \le i  \lt  j \le n$$$ and two columns $$$1 \le k  \lt  l \le n$$$ that satisfy the following three conditions: <ul> <li> $$$C[i,k]=C[j,l]$$$; </li><li> $$$C[j,k]=C[i,l]$$$; </li><li> $$$C[i,k] \neq C[j,k]$$$. </li></ul> </li></ul><p>There is a monochrome matrix $$$M$$$ of size $$$n \times n$$$, where all cells are initially white. Please solve $$$q$$$ queries of the following kind:</p><ul> <li> $$$r\;c$$$: Change the color of the cell $$$(r,c)$$$ in $$$M$$$ to <span class="tex-font-style-bf">black</span>. Then, determine if $$$M$$$ is monotone or not. </li></ul><p>For each query, it is guaranteed that the color of the cell $$$(r,c)$$$ was white before the query.</p><p>Do note that the updates are persistent. In other words, the change in color from one query affects the later queries as well.</p></div><div class="input-specification"><div class="section-title">Input</div><p>Each test contains multiple test cases. The first line contains the number of test cases $$$t$$$ ($$$1 \le t \le 10^3$$$). The description of the test cases follows. </p><p>The first line of each test case contains two integers $$$n$$$ and $$$q$$$ ($$$2 \le n \le \color{red}{2\,000\,000}$$$, $$$1 \le q \le \min(n^2,\color{red}{2\,000\,000})$$$).</p><p>Each of the $$$q$$$ following lines contains two integers $$$r_i$$$, $$$c_i$$$ denoting the $$$i$$$-th query ($$$1 \le r_i,c_i \le n$$$).</p><p>For each query, it is guaranteed that the color of the cell $$$(r,c)$$$ was white before the query.</p><p>It is guaranteed that the sum of $$$n$$$ over all test cases does not exceed $$$\color{red}{2\,000\,000}$$$.</p><p>It is guaranteed that the sum of $$$q$$$ over all test cases does not exceed $$$\color{red}{2\,000\,000}$$$.</p></div><div class="output-specification"><div class="section-title">Output</div><p>For each query, output "<span class="tex-font-style-tt">YES</span>" or "<span class="tex-font-style-tt">NO</span>" on a separate line based on the answer of the query.</p><p>You can output the answer in any case. For example, the strings "<span class="tex-font-style-tt">yEs</span>", "<span class="tex-font-style-tt">yes</span>", and "<span class="tex-font-style-tt">Yes</span>" will also be recognized as positive responses.</p></div><div class="sample-tests"><div class="section-title">Example</div><div class="sample-test"><div class="input"><div class="title">Input<div title="Copy" data-clipboard-target="#id000847125724334089" id="id0013754102455777062" class="input-output-copier">Copy</div></div><pre id="id000847125724334089"><div class="test-example-line test-example-line-even test-example-line-0">2</div><div class="test-example-line test-example-line-odd test-example-line-1">3 9</div><div class="test-example-line test-example-line-odd test-example-line-1">2 2</div><div class="test-example-line test-example-line-odd test-example-line-1">3 3</div><div class="test-example-line test-example-line-odd test-example-line-1">2 3</div><div class="test-example-line test-example-line-odd test-example-line-1">3 1</div><div class="test-example-line test-example-line-odd test-example-line-1">3 2</div><div class="test-example-line test-example-line-odd test-example-line-1">1 1</div><div class="test-example-line test-example-line-odd test-example-line-1">1 2</div><div class="test-example-line test-example-line-odd test-example-line-1">2 1</div><div class="test-example-line test-example-line-odd test-example-line-1">1 3</div><div class="test-example-line test-example-line-even test-example-line-2">5 17</div><div class="test-example-line test-example-line-even test-example-line-2">2 1</div><div class="test-example-line test-example-line-even test-example-line-2">4 5</div><div class="test-example-line test-example-line-even test-example-line-2">4 1</div><div class="test-example-line test-example-line-even test-example-line-2">3 3</div><div class="test-example-line test-example-line-even test-example-line-2">3 1</div><div class="test-example-line test-example-line-even test-example-line-2">3 5</div><div class="test-example-line test-example-line-even test-example-line-2">1 3</div><div class="test-example-line test-example-line-even test-example-line-2">1 5</div><div class="test-example-line test-example-line-even test-example-line-2">1 1</div><div class="test-example-line test-example-line-even test-example-line-2">5 3</div><div class="test-example-line test-example-line-even test-example-line-2">5 5</div><div class="test-example-line test-example-line-even test-example-line-2">5 1</div><div class="test-example-line test-example-line-even test-example-line-2">1 4</div><div class="test-example-line test-example-line-even test-example-line-2">5 2</div><div class="test-example-line test-example-line-even test-example-line-2">5 4</div><div class="test-example-line test-example-line-even test-example-line-2">1 2</div><div class="test-example-line test-example-line-even test-example-line-2">2 5</div></pre></div><div class="output"><div class="title">Output<div title="Copy" data-clipboard-target="#id005210432515724214" id="id00629334302188077" class="input-output-copier">Copy</div></div><pre id="id005210432515724214"><div class="test-example-line test-example-line-odd test-example-line-1">YES</div><div class="test-example-line test-example-line-odd test-example-line-1">NO</div><div class="test-example-line test-example-line-odd test-example-line-1">YES</div><div class="test-example-line test-example-line-odd test-example-line-1">NO</div><div class="test-example-line test-example-line-odd test-example-line-1">YES</div><div class="test-example-line test-example-line-odd test-example-line-1">NO</div><div class="test-example-line test-example-line-odd test-example-line-1">NO</div><div class="test-example-line test-example-line-odd test-example-line-1">YES</div><div class="test-example-line test-example-line-odd test-example-line-1">YES</div><div class="test-example-line test-example-line-even test-example-line-2">YES</div><div class="test-example-line test-example-line-even test-example-line-2">NO</div><div class="test-example-line test-example-line-even test-example-line-2">YES</div><div class="test-example-line test-example-line-even test-example-line-2">NO</div><div class="test-example-line test-example-line-even test-example-line-2">NO</div><div class="test-example-line test-example-line-even test-example-line-2">YES</div><div class="test-example-line test-example-line-even test-example-line-2">NO</div><div class="test-example-line test-example-line-even test-example-line-2">NO</div><div class="test-example-line test-example-line-even test-example-line-2">YES</div><div class="test-example-line test-example-line-even test-example-line-2">NO</div><div class="test-example-line test-example-line-even test-example-line-2">NO</div><div class="test-example-line test-example-line-even test-example-line-2">YES</div><div class="test-example-line test-example-line-even test-example-line-2">YES</div><div class="test-example-line test-example-line-even test-example-line-2">NO</div><div class="test-example-line test-example-line-even test-example-line-2">YES</div><div class="test-example-line test-example-line-even test-example-line-2">YES</div><div class="test-example-line test-example-line-even test-example-line-2">YES</div></pre></div></div></div><div class="note"><div class="section-title">Note</div><p>In the first test case, $$$M$$$ has size $$$3 \times 3$$$. The states of $$$M$$$ after each query are as shown below.</p><p>$$$$$$\quad\, \begin{bmatrix} \square & \square & \square\\ \square & \blacksquare & \square\\ \square & \square & \square \end{bmatrix} \to \begin{bmatrix} \square & \square & \square\\ \square & \color{red}{\blacksquare} & \color{red}{\square}\\ \square & \color{red}{\square} & \color{red}{\blacksquare} \end{bmatrix} \to \begin{bmatrix} \square & \square & \square\\ \square & \blacksquare & \blacksquare\\ \square & \square & \blacksquare \end{bmatrix} \\\to \begin{bmatrix} \square & \square & \square\\ \color{red}{\square} & \color{red}{\blacksquare} & \blacksquare\\ \color{red}{\blacksquare} & \color{red}{\square} & \blacksquare \end{bmatrix} \to \begin{bmatrix} \square & \square & \square\\ \square & \blacksquare & \blacksquare\\ \blacksquare & \blacksquare & \blacksquare \end{bmatrix} \to \begin{bmatrix} \color{red}{\blacksquare} & \color{red}{\square} & \square\\ \color{red}{\square} & \color{red}{\blacksquare} & \blacksquare\\ \blacksquare & \blacksquare & \blacksquare \end{bmatrix} \\\to \begin{bmatrix} \color{red}{\blacksquare} & \blacksquare & \color{red}{\square}\\ \color{red}{\square} & \blacksquare & \color{red}{\blacksquare}\\ \blacksquare & \blacksquare & \blacksquare \end{bmatrix} \to \begin{bmatrix} \blacksquare & \blacksquare & \square\\ \blacksquare & \blacksquare & \blacksquare\\ \blacksquare & \blacksquare & \blacksquare \end{bmatrix} \to \begin{bmatrix} \blacksquare & \blacksquare & \blacksquare\\ \blacksquare & \blacksquare & \blacksquare\\ \blacksquare & \blacksquare & \blacksquare \end{bmatrix}$$$$$$</p><p>On queries where $$$M$$$ is not monotonic, the four squares highlighted in red denote cells that violate the condition stated above.</p></div>