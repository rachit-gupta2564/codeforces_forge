<h3><a href="https://codeforces.com/contest/2178/problem/E" target="_blank" rel="noopener noreferrer">Flatten or Concatenate</a></h3>

<div class="header"><div class="title">E. Flatten or Concatenate</div><div class="time-limit"><div class="property-title">time limit per test</div>3 seconds</div><div class="memory-limit"><div class="property-title">memory limit per test</div>512 megabytes</div><div class="input-file input-standard"><div class="property-title">input</div>standard input</div><div class="output-file output-standard"><div class="property-title">output</div>standard output</div></div><div><p>   </p><p><span class="tex-font-style-it">This is an interactive problem.</span> </p><p>While procrastinating at work, Dilhan the elf stumbled upon two arrays $$$a$$$ and $$$b$$$. Initially, both of them consist of a single integer $$$2^k$$$ (i.e., $$$a=b=[2^k]$$$), where $$$k$$$ is a non-negative integer.</p><p>Dilhan then applied the following two types of operations an arbitrary number of times (possibly zero), in any order: </p><ol> <li> Flatten — Choose either $$$a$$$ or $$$b$$$, and select <span class="tex-font-style-bf">any</span> element $$$x$$$ that is <span class="tex-font-style-bf">maximal</span> within that array ($$$x$$$ does <span class="tex-font-style-bf">not</span> need to be maximal in the other array). Then, replace $$$x$$$ with two copies of $$$\frac x2$$$ in the same position. This operation can only be applied if $$$x$$$ is even. </li><li> Concatenate — Set <span class="tex-font-style-bf">both</span> $$$a$$$ and $$$b$$$ to be $$$a+b$$$, where $$$+$$$ denotes array concatenation. </li></ol><p>After performing these operations, Dilhan discards $$$b$$$, hides $$$a$$$ from you, and challenges you to a game.</p><p>Let $$$n$$$ be the length of the hidden array $$$a$$$. You may make the following query: </p><ul> <li> Choose an interval $$$[l, r]$$$ ($$$1\le l\le r\le n$$$), and Dilhan will tell you the sum $$$a_l+a_{l+1}+\cdots+a_r$$$. </li></ul><p>Determine the value of the maximum element of $$$a$$$ by making at most $$$300$$$ queries.</p></div><div class="input-specification"><div class="section-title">Input</div><p>Each test contains multiple test cases. The first line contains the number of test cases $$$t$$$ ($$$1 \le t \le 100$$$). The description of the test cases follows. </p><p>The first line of each test case contains a single integer $$$n$$$ ($$$1 \le n \le 10^5$$$) — the length of $$$a$$$.</p><p>It is guaranteed that $$$1\le a_i\le 2^{30}$$$, and the array $$$a$$$ can be generated by the process described in the statements.</p><p>It is guaranteed that the sum of $$$n$$$ over all test cases does not exceed $$$10^5$$$. </p></div><div><div class="section-title">Interaction</div><p>For each test case, you are first given an integer $$$n$$$ — the length of the hidden array $$$a$$$. You may then make up to $$$300$$$ queries.</p><p>To make a query, print a line in the following format:</p><ul> <li> $$$\texttt{?}\;l\;r$$$ ($$$1\le l\le r\le n$$$) — the indices chosen for the query. </li></ul><p>After you print a query, the interactor will respond with a single integer — the sum $$$a_l+a_{l+1}+\ldots+a_r$$$.</p><p>To report that you have determined the value of the maximum element of $$$a$$$, print your answer in the following format:</p><ul> <li> $$$\texttt{!}\; m$$$ ($$$1\le m\le 2^{30}$$$) — the value of the maximum element. </li></ul><p>Printing the answer does not count as one of the $$$300$$$ queries.</p><p>After printing the answer, proceed to the next test case. If the current test case is the last one, terminate the program.</p><p>After printing each query do not forget to output the end of line and flush$$$^{\text{∗}}$$$ the output. Otherwise, you will get <span class="tex-font-style-tt">Idleness limit exceeded</span> verdict.</p><p>If, at any interaction step, you read $$$-1$$$ instead of valid data, your solution must exit immediately. This means that your solution will receive <span class="tex-font-style-tt">Wrong answer</span> because of an invalid query or any other mistake. Failing to exit can result in an arbitrary verdict because your solution will continue to read from a closed stream. </p><p>The interactor in this problem is <span class="tex-font-style-bf">not</span> adaptive. In other words, the array $$$a$$$ is fixed before any queries and will not change during the interaction.</p><p><span class="tex-font-style-bf">Hacks are disabled in this problem.</span></p><div class="statement-footnote"><p>$$$^{\text{∗}}$$$To flush, use: </p><ul> <li> <span class="tex-font-style-tt">fflush(stdout)</span> or <span class="tex-font-style-tt">cout.flush()</span> in C++; </li><li> <span class="tex-font-style-tt">sys.stdout.flush()</span> in Python; </li><li> see the documentation for other languages. </li></ul></div></div><div class="sample-tests"><div class="section-title">Example</div><div class="sample-test"><div class="input"><div class="title">Input<div title="Copy" data-clipboard-target="#id00607462704178325" id="id005338219742167145" class="input-output-copier">Copy</div></div><pre id="id00607462704178325">4
11

9

4

12

1

1

8

4

4

4

4

8

</pre></div><div class="output"><div class="title">Output<div title="Copy" data-clipboard-target="#id001622797523759919" id="id005999183918897021" class="input-output-copier">Copy</div></div><pre id="id001622797523759919">

? 3 8

? 1 4

? 5 11

! 2

? 1 1

! 1

? 1 1

? 2 2

? 3 3

? 4 4

! 4

! 1073741824</pre></div></div></div><div class="note"><div class="section-title">Note</div><p>In the first test case, Dilhan's hidden array $$$a$$$ is $$$[1, 1, 1, 1, 2, 2, 2, 1, 1, 2, 2]$$$. It can be generated by the following process:</p><center> <table class="tex-tabular bordertable"><tbody><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">#</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">Type</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$a$$$ after operation</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$b$$$ after operation</td></tr><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">0</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom"></td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[4]$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[4]$$$</td></tr><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">1</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">Flatten $$$a$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[\underline 4] \to {[2, 2]}$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[4]$$$</td></tr><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">2</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">Flatten $$$b$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[2, 2]$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[\underline 4] \to {[2, 2]}$$$</td></tr><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">3</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">Flatten $$$a$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[2, \underline 2] \to {[2, 1, 1]}$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[2, 2]$$$</td></tr><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">4</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">Concatenate</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[2, 1, 1, 2, 2]$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[2, 1, 1, 2, 2]$$$</td></tr><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">5</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">Flatten $$$a$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[\underline 2, 1, 1, 2, 2]\to {[1, 1, 1, 1, 2, 2]}$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[2, 1, 1, 2, 2]$$$</td></tr><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">6</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">Concatenate</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[1, 1, 1, 1, 2, 2, 2, 1, 1, 2, 2]$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[1, 1, 1, 1, 2, 2, 2, 1, 1, 2, 2]$$$</td></tr></tbody></table> </center><ul> <li> For the query $$$\mathtt{?\;3\;8}$$$, the jury responded with $$$1+1+2+2+2+1=9$$$; </li><li> For the query $$$\mathtt{?\;1\;4}$$$, the jury responded with $$$1+1+1+1=4$$$; </li><li> For the query $$$\mathtt{?\;5\;11}$$$, the jury responded with $$$2+2+2+1+1+2+2=12$$$. </li></ul><p>And the value of the maximum element of $$$a$$$ is $$$2$$$.</p><p>In the second test case, the array $$$a$$$ has only one element. By the query, the value of the only element is $$$1$$$, and it must also be the maximum value.</p><p>In the third test case, Dilhan's hidden array $$$a$$$ is $$$[4, 4, 4, 4, 4, 4, 4, 4]$$$. It can be generated by the following process:</p><center> <table class="tex-tabular bordertable"><tbody><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">#</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">Type</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$a$$$ after operation</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$b$$$ after operation</td></tr><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">0</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom"></td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[4]$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[4]$$$</td></tr><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">1</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">Concatenate</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[4, 4]$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[4, 4]$$$</td></tr><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">2</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">Concatenate</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[4, 4, 4, 4]$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[4, 4, 4, 4]$$$</td></tr><tr><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">3</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">Concatenate</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[4, 4, 4, 4, 4, 4, 4, 4]$$$</td><td class="tex-tabular-border-left tex-tabular-text-align-center tex-tabular-border-right tex-tabular-border-top tex-tabular-border-bottom">$$$[4, 4, 4, 4, 4, 4, 4, 4]$$$</td></tr></tbody></table> </center><p>And the value of the maximum element of $$$a$$$ is $$$4$$$.</p><p>In the fourth test case, Dilhan's hidden array $$$a$$$ is $$$[2^{29}, 2^{29}, 2^{30}, 2^{29}, 2^{28}, 2^{28}, 2^{29}, 2^{29}]$$$.</p></div>